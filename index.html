<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Location</title>
</head>
<body>
    <h2>مکان‌یابی زنده کاربر</h2>
    <p id="status">در حال دریافت...</p>

    <script>
        function sendLocation(lat, lon) {
            fetch('/location', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({latitude: lat, longitude: lon})
            }).then(res => console.log("مکان ارسال شد"))
              .catch(err => console.error("خطا:", err));
        }

        function startTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    document.getElementById("status").textContent = مکان فعلی: ${lat}, ${lon};
                    sendLocation(lat, lon);
                }, error => {
                    document.getElementById("status").textContent = "اجازه مکان‌یابی داده نشد!";
                });
            } else {
                document.getElementById("status").textContent = "مرورگر شما پشتیبانی نمی‌کند.";
            }
        }

        startTracking();
    </script>
</body>
</html>