<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ذخیره موقعیت کاربر</title>
</head>
<body>
  <p id="status">در حال دریافت موقعیت...</p>
  <script>
    window.onload = function () {
      const status = document.getElementById('status');

      // چک کردن پشتیبانی مرورگر از Geolocation
      if (!navigator.geolocation) {
        status.innerText = "❌ مرورگر شما موقعیت جغرافیایی را پشتیبانی نمی‌کند.";
        return;
      }

      // درخواست موقعیت کاربر
      navigator.geolocation.getCurrentPosition(
        position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          // آماده‌سازی داده‌ها برای ذخیره در فایل JSON
          const locationData = {
            lat,
            lon,
            timestamp: new Date().toISOString()
          };

          // تبدیل داده‌ها به رشته JSON زیبا
          const jsonStr = JSON.stringify(locationData, null, 2);

          // ایجاد Blob برای ساخت فایل
          const blob = new Blob([jsonStr], { type: "application/json" });

          // ساخت URL موقت برای فایل
          const url = URL.createObjectURL(blob);

          // ساخت یک لینک دانلود موقت
          const a = document.createElement("a");
          a.href = url;

          // نام فایل با زمان فعلی (برای جلوگیری از بازنویسی)
          a.download = `location_${Date.now()}.json`;

          // اضافه کردن لینک به بدنه صفحه و شبیه‌سازی کلیک برای دانلود
          document.body.appendChild(a);
          a.click();

          // حذف لینک و آزادسازی URL
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          status.innerText = "✅ موقعیت دریافت و فایل ذخیره شد.";
        },
        () => {
          status.innerText = "❌ کاربر اجازه موقعیت را نداد.";
        }
      );
    };
  </script>
</body>
</html>
